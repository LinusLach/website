<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Weiterführende Konzepte des Dataminings – Data Mining Übungsmaterial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04_Regressions_Baeume.html" rel="next">
<link href="./02_Lineare_Regression.html" rel="prev">
<script src="site_libs/cookie-consent/cookie-consent.js"></script>
<link href="site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-K9CJ1KN8ZH"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-K9CJ1KN8ZH', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03_Wichtige_Konzepte.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Weiterführende Konzepte des Dataminings</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Mining Übungsmaterial</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vorwort</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_Einfuehrung.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">(Kurz)Einführung in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_Lineare_Regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lineare Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_Wichtige_Konzepte.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Weiterführende Konzepte des Dataminings</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_Regressions_Baeume.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regressionsbäume</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#training-und-test-split" id="toc-training-und-test-split" class="nav-link active" data-scroll-target="#training-und-test-split"><span class="header-section-number">3.1</span> Training und Test Split</a>
  <ul>
  <li><a href="#training--und-testsplit-in-r" id="toc-training--und-testsplit-in-r" class="nav-link" data-scroll-target="#training--und-testsplit-in-r"><span class="header-section-number">3.1.1</span> Training- und Testsplit in R</a></li>
  </ul></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation"><span class="header-section-number">3.2</span> Cross-Validation</a>
  <ul>
  <li><a href="#cross-validation-in-r" id="toc-cross-validation-in-r" class="nav-link" data-scroll-target="#cross-validation-in-r"><span class="header-section-number">3.2.1</span> Cross-Validation in R</a></li>
  </ul></li>
  <li><a href="#umgang-mit-fehlenden-daten" id="toc-umgang-mit-fehlenden-daten" class="nav-link" data-scroll-target="#umgang-mit-fehlenden-daten"><span class="header-section-number">3.3</span> Umgang mit fehlenden Daten</a>
  <ul>
  <li><a href="#sec-imputation" id="toc-sec-imputation" class="nav-link" data-scroll-target="#sec-imputation"><span class="header-section-number">3.3.1</span> Imputation</a>
  <ul class="collapse">
  <li><a href="#sec-coldimp" id="toc-sec-coldimp" class="nav-link" data-scroll-target="#sec-coldimp"><span class="header-section-number">3.3.1.1</span> Imputation durch Lagemaße (cold imputation)</a></li>
  <li><a href="#imputation-durch-regression" id="toc-imputation-durch-regression" class="nav-link" data-scroll-target="#imputation-durch-regression"><span class="header-section-number">3.3.1.2</span> Imputation durch Regression</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#merkmalsselektion-mithilfe-von-lasso-regression" id="toc-merkmalsselektion-mithilfe-von-lasso-regression" class="nav-link" data-scroll-target="#merkmalsselektion-mithilfe-von-lasso-regression"><span class="header-section-number">3.4</span> Merkmalsselektion mithilfe von Lasso-Regression</a></li>
  <li><a href="#übungsaufgaben" id="toc-übungsaufgaben" class="nav-link" data-scroll-target="#übungsaufgaben"><span class="header-section-number">3.5</span> Übungsaufgaben</a></li>
  <li><a href="#lösungen" id="toc-lösungen" class="nav-link" data-scroll-target="#lösungen"><span class="header-section-number">3.6</span> Lösungen</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Weiterführende Konzepte des Dataminings</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In diesem Kapitel werden wir uns mit weiterführenden Konzepten des Data Minings auseinandersetzen. Diese umfassen das Aufteilen der Daten in Trainings- und Testdaten, Cross-Validation (Kreuzvalidierung), die Imputation von fehlenden Werten sowie die Merkmalsselektion.</p>
<section id="training-und-test-split" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="training-und-test-split"><span class="header-section-number">3.1</span> Training und Test Split</h2>
<p>Die Parameter der linearen Regressionsmodelle aus <a href="02_Lineare_Regression.html" class="quarto-xref">Kapitel&nbsp;<span>2</span></a> haben wir unter Verwendung aller Daten geschätzt. Falls wir allerdings erwarten, dass neue Daten zu den Datensätzen hinzugefügt werden, ist das nicht die beste Idee, da wir nicht wissen wie gut unser Modell auf zuvor ungesehenen Daten funktioniert. Eine gängige Praxis ist deshalb die Daten in ein Trainings- und Test Set aufzuteilen. Mit den Trainingsdaten werden die Parameter des Modells geschätzt und mit den Testdaten wird die sogenannte Out-Of-Sample (OOS) Performance gemessen.</p>
<p>Beim Aufteilen der Daten sollte beachtet werden, dass das Verhältnis zwischen den beiden Teilen sinnvoll gewählt wird und die Aufteilungs zufällig gewählt wird.</p>
<div id="exm-TrainTestSplit" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 3.1</strong></span> In einem gegebenen Datensatz sind 101 Observationen <span class="math inline">\((x,y)\in\mathbb{R}\)</span>. Nun werden die letzten <span class="math inline">\(20\%\)</span> diese Daten als Testdaten festgelegt und die ersten <span class="math inline">\(80\%\)</span> der Daten als Trainingsdaten. Mit den Trainingsdaten schätzen wir die Parameter eins linearen Regressionsmodells und generieren Vorhersagen auf Basis der Testdaten. Wir können dann die Vorhersagegüte des Modells auf den Testdaten visuell evaluieren und uns ein</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03_Wichtige_Konzepte_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Im obigen Beispiel ist klar zu erkennen, dass der Split (also das Aufteilen der Daten) nicht optimal war. Zwar erzeugen die geschätzten Parameter gute vorhersagen auf den Trainingsdaten, allerdings sind die Vorhersagefehler in den Testdaten sehr hoch.</p>
<p>Wenn wir stattdessen die Daten in zufällige Trainings- und Testdaten aufteilen, ist für das gegebene Modell der In-Sample Fehler (IS-Fehler) zwar höher, allerdings der OOS-Fehler niedriger:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="03_Wichtige_Konzepte_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<p>Im obigen Beispiel haben wir gesehen, dass ein zufälliger Split zu besseren Ergebnissen führen kann. Die Frage ist nun, wie wir in R einen zufälligen Split erzeugen können!</p>
<section id="training--und-testsplit-in-r" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="training--und-testsplit-in-r"><span class="header-section-number">3.1.1</span> Training- und Testsplit in R</h3>
<p>Die <code>rsample::initial_split(), rsample::training()</code> und <code>rsample::testing()</code> Funktionen erlauben ein einfaches und effizientes Aufteilen der Daten in Trainings- und Testdaten. Das <code>{rsample}</code> Paket ist teil des <code>{tidymodels}</code> Ökosystems, weshalb wir auch einfach mit dem Befehl <code>library(tidymodels)</code> dieses hinzufügen können. In <a href="02_Lineare_Regression.html#sec-MLRR" class="quarto-xref"><span>Section 2.3.1</span></a> haben wir den <code>penguins</code> Datensatz verwendet, um die Parameter eines multiplen linearen Regressionsmodells zu schätzen. Des weiteren haben wir in <a href="02_Lineare_Regression.html#sec-MSE" class="quarto-xref"><span>Section 2.3.4.3</span></a> das MLR Modell auf dem gesamten Datensatz anhand der RMSE Metrik evaluiert. Hierbei hat sich ein RMSE Wert von <code>282</code> ergeben. Im Folgenden wollen wir das gleiche Modell erstellen, allerdings die Parameter nur mit den Trainingsdaten schätzen und die Performance dann auf den Testdaten evaluieren.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>data_penguin <span class="ot">&lt;-</span> palmerpenguins<span class="sc">::</span>penguins</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>split_penguin <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> data_penguin, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a>data_train <span class="ot">&lt;-</span> <span class="fu">training</span>(split_penguin)</span>
<span id="cb1-7"><a href="#cb1-7"></a>data_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(split_penguin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In der dritten Zeile wenden wir den <code>set.seed()</code> Befehl an. Diese Funktion ist wichtig um die Reproduzierbarkeit der Resultate zu gewährleisten, wenn zufällige Prozesse im Programmablauf involviert sind. Dadurch, dass wir im folgenden die Daten zufällig aufteilen, wird unter der Verwendung der <code>set.seed()</code> Funktion gewährleistet, dass bei jedem durchführen der darauffolgenden Zeilen, der gleiche zufällige Split durchgeführt wird.</p>
<p>In Zeile 5 verwenden wir die <code>initial_split()</code> Funktion, um die Daten aufzuteilen. Das Argument <code>data = data_penguin</code> beschreibt welche daten Aufgeteilt werden sollen und das Argument <code>prop=0.8</code> steuert die Proportionalität des Splits. Der Wert <code>prop = 0.8</code> teilt die Daten somit zufällig in <span class="math inline">\(80\%\)</span> Trainings und <span class="math inline">\(20\%\)</span> Testdaten ein.</p>
<p>In Zeile 6 und 7 verwenden wir dann die <code>training()</code> und <code>testing()</code> Funktionen um aus dem <code>split_pinguin</code> Objekt die Trainings- und Testdaten zu extrahieren. Die Trainings- und Testdaten sind daraufhin in einem Data-Frame bzw. Tibble gespeichert und können wie gewohnt verwendet werden.</p>
<p>Wir können nun die Parameter des MLR Modells schätzen wie wir es in #sec-MLRR getan haben:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>mlr_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>()</span>
<span id="cb2-2"><a href="#cb2-2"></a>mlr_fit <span class="ot">&lt;-</span> mlr_spec <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">fit</span>(<span class="at">data =</span> data_train,</span>
<span id="cb2-4"><a href="#cb2-4"></a>      <span class="at">formula =</span> body_mass_g <span class="sc">~</span>.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lediglich in Zeile 3 haben wir anstatt des <code>data_penguin</code> Datensatzes nun den <code>data_train</code> Datensatz verwendet. Da wir nur an der Modellgüte auf Basis der Testdaten interessiert sind, evaluieren wir an dieser Stelle nicht weiter das Modell auf Basis der Trainingsdaten.</p>
<p>Mit der <code>augment()</code> Funktion können wir nun wieder Vorhersagen und die dazugehörigen Residuen und mithilfe der <code>rmse()</code> Funktion den RMSE berechnen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mlr_fit <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(data_test) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmse</span>(<span class="at">truth =</span> .pred, <span class="at">estimate =</span> body_mass_g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard        289.</code></pre>
</div>
</div>
<p>Der Test Fehler mit dem Wert <code>289</code> ist also nur knapp größer als der Fehler welchen wir in <a href="02_Lineare_Regression.html#sec-MSE" class="quarto-xref"><span>Section 2.3.4.3</span></a> beobachten konnten (<code>282</code>). Wir können deshalb also für zuvor ungesehene Pinguine erwarten, dass das Gewicht im Schnitt <span class="math inline">\(289\)</span> g höher oder niedriger als der tatsächliche Wert geschätzt wird.</p>
</section>
</section>
<section id="cross-validation" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="cross-validation"><span class="header-section-number">3.2</span> Cross-Validation</h2>
<p>Das Konzpet der Cross-Validation (Kreuzvalidierung) knüpft direkt an das des Aufteilens der Trainings- und Testdaten an. Die Idee hierbei ist, dass wir die Daten nicht nur ein Mal in Trainings- und Testdaten aufteilen, sondern mehrmals auf verschiedene Art und weise. Die folgende Grafik illustriert die Idee der five-fold Cross-Validation:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/cv_tp.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>In einem ersten Schritt, teilen wir die Daten in fünf gleichgroße, zufällige Teildatensätze (Folds) auf. Vereinigt ergeben diese Teildatensätze also wieder den gesamten Datensatz. Diese fünf Folds werden dann fünf mal dupliziert, so dass wir jeden Fold fünf Mal auffinden. Die einzelnen Duplikate werden hierbei Splits genannt. In jedem dieser 5 Splits wird dann ein anderer Fold als Testdaten definiert und die verbleibenden vier Folds als Trainingsdaten. Wir können dann vier verschiedene Trainings- und Testdatensätze verwenden um zum Beispiel die Parameter eines linearen Modells zu schätzen.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/y-tho-meme-rcm1300x0.jpg" class="img-fluid figure-img" style="width:30.0%"></p>
<figcaption><a href="https://www.giga.de/extra/meme/tipps/y-tho-meme-bedeutung-herkunft-einsatzmoeglichkeit/">Quelle</a></figcaption>
</figure>
</div>
<p>In <a href="#exm-TrainTestSplit" class="quarto-xref">Example&nbsp;<span>3.1</span></a> haben wir gesehen, dass ein unvorteilhafter Training- und Testsplit zu verzerrten Ergebnissen führen kann. Selbst bei einem zufällig ausgewählten Trainings- und Testsplit besteht das Risiko einen unvorteilhaften Split zu erstellen. Indem wir die Daten also systematisch aufteilen und den Testfehler mitteln, können wir das Risiko mitigieren. Wir können den Cross-Validation Test Fehler durch den Term</p>
<p><span class="math display">\[
\text{CV-Loss} = \frac{1}{5}\sum_{i=1}^{5} \text{Loss}_{\text{OOS}_i}(y,\hat{y})
\]</span> berechnen. <span class="math inline">\(\text{Loss}_{\text{OOS}_i}\)</span> steht hierbei für die OOS Performance in Split <span class="math inline">\(i\)</span> bezüglich einer beliebigen Loss Funktion wie zum Beispiel RMSE.</p>
<p>Wir können die Anzahl der Splits bzw. Folds auch beliebig höher oder niedriger wählen. Falls wir zum Beispiel auf einen Datensatz mit <span class="math inline">\(n\)</span> Datenpunkten <span class="math inline">\(n\)</span>-Fold Cross-Validation anwenden, d.h. die Testsets aus einem Split entsprechen einem einzelnen Sample, dann spricht man auch von Leave-One-Out Cross-Validation. Dieses Prinzip garantiert zwar einen sehr robusten <span class="math inline">\(\text{CV-Loss}\)</span>, kann aber unter umständen auch zu sehr langen Berechnungszeiten führen, da wir schließlich für jeden Split ein Modell trainieren.</p>
<section id="cross-validation-in-r" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="cross-validation-in-r"><span class="header-section-number">3.2.1</span> Cross-Validation in R</h3>
<p>Die <code>rsample::vfold_cv</code> Funktion ermöglicht uns ein Cross-Validation Objekt zu erstellen. Dieses ist nichts anderes als ein verschachteltes Tibble bzw. Data Frame. D.h. jeder Eintrag ist wieder ein Tibble oder Data Frame selber.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>folds_penguin <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(<span class="at">data =</span> data_penguin, <span class="at">v =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Neben dem Argument <code>data</code> welches die Daten spezifiziert müssen wir noch die Anzahl der Folds übergeben. Diese können wir über das Argument <code>v</code> steuern. Falls wir also <code>v=5</code> setzen, dann bedeutet das, dass wir 5-Fold Cross-Validation anwenden.</p>
<p>Wir können nun die Parameter eines MLR Modells für jeden Split schätzen und den CV-Loss berechnen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>mlr_fit_cv <span class="ot">&lt;-</span> mlr_spec <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">fit_resamples</span>(</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="at">resamples =</span> folds_penguin,</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="at">preprocessor =</span> body_mass_g <span class="sc">~</span>.</span>
<span id="cb6-5"><a href="#cb6-5"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>In der ersten Zeile verwenden wir das bereits spezifizierte MLR Modell <code>mlr_spec</code>, um für dieses auf Basis jedes Spllits die Parameter zu schätzen.</li>
<li>In Zeile 2. verwenden wir statt der <code>fit</code> Funktion die <code>fit_resamples</code> Funktion. Wie der Name bereits vermuten lässt, können wir mit dieser Funktion die Parameter auf Basis der verschiedenen Splits berechnen.</li>
<li>Wir müssen deshalb in Zeile 3 statt dem Argument <code>data</code> das Argument <code>resamples = folds_penguin</code> übergeben.</li>
<li>In der vierten Zeile spezifizieren wir dann mit dem <code>preprocessor</code> Argument noch die Formel, bezüglich welcher die Parameter geschätzt werden sollen. Äquivalent dazu wird in der <code>fit</code> Funktion das Argument <code>formula</code> verwendet. Hintergrund für die unterschiedlichen Argumentnamen ist, dass wir die <code>fit_resamples</code> Funktion noch viel umfangreicher nutzen könnten, das aber den Rahmen dieser Vorlesung sprengt (siehe bei Interesse <a href="https://linus-lach.de/teaching/ml/03_regularization#recipes-and-workflows">Machine Learning Übungsskrip</a>).</li>
</ol>
<p>Um nun die Performance der Cross-Validation zu überprüfen, können wir die <code>tune::collect_metrics</code> Funktion verwenden:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mlr_fit_cv <span class="sc">%&gt;%</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Der Rückgabewert der <code>collect_metrics</code> Funktion ist ein Tibble, welches verschiedene Informationen der Evaluation des CV-Objekts enthält:</p>
<div class="cell">
<div class="cell-output-display">
<div id="fulcdvnltn" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fulcdvnltn table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fulcdvnltn thead, #fulcdvnltn tbody, #fulcdvnltn tfoot, #fulcdvnltn tr, #fulcdvnltn td, #fulcdvnltn th {
  border-style: none;
}

#fulcdvnltn p {
  margin: 0;
  padding: 0;
}

#fulcdvnltn .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fulcdvnltn .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fulcdvnltn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fulcdvnltn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fulcdvnltn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fulcdvnltn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fulcdvnltn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fulcdvnltn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fulcdvnltn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fulcdvnltn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fulcdvnltn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fulcdvnltn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fulcdvnltn .gt_spanner_row {
  border-bottom-style: hidden;
}

#fulcdvnltn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fulcdvnltn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fulcdvnltn .gt_from_md > :first-child {
  margin-top: 0;
}

#fulcdvnltn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fulcdvnltn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fulcdvnltn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fulcdvnltn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fulcdvnltn .gt_row_group_first td {
  border-top-width: 2px;
}

#fulcdvnltn .gt_row_group_first th {
  border-top-width: 2px;
}

#fulcdvnltn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fulcdvnltn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fulcdvnltn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fulcdvnltn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fulcdvnltn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fulcdvnltn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fulcdvnltn .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fulcdvnltn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fulcdvnltn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fulcdvnltn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fulcdvnltn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fulcdvnltn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fulcdvnltn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fulcdvnltn .gt_left {
  text-align: left;
}

#fulcdvnltn .gt_center {
  text-align: center;
}

#fulcdvnltn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fulcdvnltn .gt_font_normal {
  font-weight: normal;
}

#fulcdvnltn .gt_font_bold {
  font-weight: bold;
}

#fulcdvnltn .gt_font_italic {
  font-style: italic;
}

#fulcdvnltn .gt_super {
  font-size: 65%;
}

#fulcdvnltn .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fulcdvnltn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fulcdvnltn .gt_indent_1 {
  text-indent: 5px;
}

#fulcdvnltn .gt_indent_2 {
  text-indent: 10px;
}

#fulcdvnltn .gt_indent_3 {
  text-indent: 15px;
}

#fulcdvnltn .gt_indent_4 {
  text-indent: 20px;
}

#fulcdvnltn .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id=".metric" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.metric</th>
<th id=".estimator" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.estimator</th>
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="std_err" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">std_err</th>
<th id=".config" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.config</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=".metric">rmse</td>
<td class="gt_row gt_left" headers=".estimator">standard</td>
<td class="gt_row gt_right" headers="mean">287.459</td>
<td class="gt_row gt_right" headers="n">5.000</td>
<td class="gt_row gt_right" headers="std_err">9.545</td>
<td class="gt_row gt_left" headers=".config">Preprocessor1_Model1</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=".metric">rsq</td>
<td class="gt_row gt_left" headers=".estimator">standard</td>
<td class="gt_row gt_right" headers="mean">0.873</td>
<td class="gt_row gt_right" headers="n">5.000</td>
<td class="gt_row gt_right" headers="std_err">0.007</td>
<td class="gt_row gt_left" headers=".config">Preprocessor1_Model1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Da wir keine weiteren Metriken spezifiziert haben, werden automatisch der RMSE, sowie <span class="math inline">\(R^2_\text{adj}\)</span> berechnet. Die Namen der Metriken sind in der Spalte <code>.metric</code> gespeichert. In der Spalte <code>mean</code> können wir den CV-Loss einsehen. Die Spalte <code>n</code> gibt die Anzahl der Folds an und <code>std_error</code> den entsprechenden Standardfehler der Metrik auf Basis der Folds. Die <code>.config</code> Spalte ist für diesen Kurs ebenso nicht relevant.</p>
</section>
</section>
<section id="umgang-mit-fehlenden-daten" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="umgang-mit-fehlenden-daten"><span class="header-section-number">3.3</span> Umgang mit fehlenden Daten</h2>
<p>In <a href="01_Einfuehrung.html#sec-pipe" class="quarto-xref"><span>Section 1.3.3.2</span></a> haben wir bereits die <code>dplyr::na.omit()</code> Funktion kennengelernt, welche ganze Einträge entfernt, wenn mindestens eine Variable in des Eintrags nicht vorhanden ist. Diese Art des Umgangs mit fehlenden Daten ist zwar einfach, birgt allerdings auf Risiken:</p>
<ul>
<li><p>Falls wir durch diese Methode eine oder mehrere Einflussreiche Variablen entfernen, können die Ergebnisse bei einer anschließenden Regression stark verzerrt sein.</p></li>
<li><p>Falls wir vorher nicht prüfen, wie viele Einträge durch das Anwenden der Funktion entfernt werden, kann unter Umständen ein Großteil der Daten entfernt werden.</p></li>
<li><p>Falls wir in den Daten ein Muster nicht erkennen, welches durch das entfernen der Einträge mit fehlenden Daten entfernt wird, kann das ebenso zu verzerrten Ergebnissen bei einer anschließenden Regression führen.</p></li>
</ul>
<p>Aufgrund der obigen Aspekte sollten wir uns also auch mit einer anderen Methode auseinandersetzen, welche sich mit dem Umgang von fehlenden Werten beschäftigt.</p>
<!-- KA ?-->
<p>Als Beispieldatensatz verwenden wir wieder den Pinguin Datensatz <code>data_penguin</code>. Zuerst sollten wir herausfinden, wie viele Einträge im Datensatz nicht vorhanden sind:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data_penguin <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colSums</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  [,1]
species              0
island               0
bill_length_mm       2
bill_depth_mm        2
flipper_length_mm    2
body_mass_g          2
sex                 11
year                 0</code></pre>
</div>
</div>
<p>Im Datensatz sind also sowohl numerische als auch nominale Werte teilweise nicht vorhanden.</p>
<section id="sec-imputation" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="sec-imputation"><span class="header-section-number">3.3.1</span> Imputation</h3>
<p>Eine Methode für den Umgang mit fehlenden Daten ist die <em>Imputation</em>. Die grundlegende Idee hierbei ist simpel: Wir ergänzen die fehlenden Werte. Das sinnvolle Ergänzen der Werte ist hierbei die größte Schwierigkeit, weshalb wir im Folgenden einige Ansätze besprechen.</p>
<section id="sec-coldimp" class="level4" data-number="3.3.1.1">
<h4 data-number="3.3.1.1" class="anchored" data-anchor-id="sec-coldimp"><span class="header-section-number">3.3.1.1</span> Imputation durch Lagemaße (cold imputation)</h4>
<p>Das wohl einfachste Imputationsverfahren ergänzt fehlende Werte durch Lagemaße wie den Mittelwert, den Median, oder den Modus. Hierbei gilt allerdings zu beachten, dass der Mittelwert und Median ausschließlich für numerische Variablen verwendet werden kann. Das folgende Code Snippet illustriert wie wir im Falle des Pinguin Datensatzes Mean- bzw. Modusimputation durchführen können:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>data_penguin_imputed <span class="ot">&lt;-</span> data_penguin <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb10-4"><a href="#cb10-4"></a>           <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">if_else</span>(</span>
<span id="cb10-5"><a href="#cb10-5"></a>             <span class="fu">is.na</span>(.),</span>
<span id="cb10-6"><a href="#cb10-6"></a>             <span class="fu">mean</span>(.,<span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-7"><a href="#cb10-7"></a>             .)</span>
<span id="cb10-8"><a href="#cb10-8"></a>    ),</span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.factor),</span>
<span id="cb10-10"><a href="#cb10-10"></a>           <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">if_else</span>(</span>
<span id="cb10-11"><a href="#cb10-11"></a>           <span class="fu">is.na</span>(.),</span>
<span id="cb10-12"><a href="#cb10-12"></a>             (</span>
<span id="cb10-13"><a href="#cb10-13"></a>               data_penguin <span class="sc">%&gt;%</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>               <span class="fu">select</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>               <span class="fu">table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>               <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-17"><a href="#cb10-17"></a>               <span class="fu">filter</span>(n<span class="sc">==</span><span class="fu">max</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb10-18"><a href="#cb10-18"></a>               <span class="fu">select</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>               <span class="fu">pluck</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-20"><a href="#cb10-20"></a>               <span class="fu">factor</span>()</span>
<span id="cb10-21"><a href="#cb10-21"></a>               ),</span>
<span id="cb10-22"><a href="#cb10-22"></a>             .)</span>
<span id="cb10-23"><a href="#cb10-23"></a>    )</span>
<span id="cb10-24"><a href="#cb10-24"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Im ersten Schritt erstellen wir einen neuen Datensatz <code>data_penguin_imputed</code>.</li>
<li>Danach übergeben wir den <code>data_penguin</code> Datensatz an die <code>mutate</code> Funktion.</li>
<li>In den Zeilen 3-7 überschreiben wir in den numerischen Spalten die fehlenden Werte mit dem entsprechenden Durchschnitt der Spalte.
<ol type="1">
<li>Hierbei verwenden wir die <code>across</code> und <code>where</code> Funktionen. Sinngemäß kann die Kombination dieser beiden Funktion als “wähle alle Spalten aus, bei welcher die Bedingung <code>...</code> gilt.” interpretiert werden. <code>...</code> ist hierbei ein Platzhalter für eine Bedingung oder Funktion. In Ziele 3 ist die Bedingung durch die <code>is.numeric()</code> Funktion gegeben, welche prüft, ob eine Spalte einen numerischen Datentyp hat.</li>
<li>Falls eine der <code>data_penguin</code> Spalten einen numerischen Datentyp besitzt, wird die <code>if_else</code> Funktion auf diese angewendet. Die <code>if_else()</code> Funktion überprüft ebenso eine Kondition, welche als erstes Argument übergeben wird. Falls die Kondition erfüllt ist, so wird das zweite Argument angewendet und falls nicht, entsprechend das dritte.</li>
<li>Wir prüfen also mithilfe der <code>if_else()</code> und <code>is.na()</code> Funktionen, ob ein Eintrag in einer Spalte den Wert <code>NA</code> oder <code>NaN</code> besitzt. Falls das der Fall ist, wird dieser Wert mit dem durchschnittlichen Wert dieser Spalte befüllt (berechnet mithilfe der <code>mean</code> Funktion). Falls der Wert nicht <code>NA</code> oder <code>NaN</code> ist, so wird der ursprüngliche Wert beibehalten.</li>
</ol>
Die Bedeutung der <code>.</code> und <code>~</code> Operatoren sind hierbei die folgenden:
<ul>
<li>Der <code>.</code> Operator wird als Platzhalter für alle Spalten verwendet, welche aus der vorherigen Operation zurückgegeben wurden. So wird zum Beispiel beim Funktionsaufruf <code>is.na(.)</code> in Zeile 5 mithilfe des <code>.</code> symbolisiert, dass jene Spalten ausgewertet werden, welche zuvor durch den <code>where(is.numeric)</code> selektiert wurden.</li>
<li>Der <code>~</code> Operator wird verwendet um eine <a href="https://en.wikipedia.org/wiki/Anonymous_function">anonyme Funktion</a> zu erstellen und anzuwenden. Da das <code>.fn</code> Argument der <code>across()</code> Funktion eine Funktion selbst erwartet, übergeben wir nicht den ausgewerteten Funktionsaufruf <code>is.na(.)</code> direkt, sondern symbolisieren mithilfe des <code>~</code> Operators, dass diese Funktion auf Basis der vorherigen Argumente ausgewertet werden soll.</li>
</ul></li>
<li>In den Zeilen 9-22 wird das Prozedere für die Faktor Variablen wiederholt mit dem entscheidenem Unterschied, dass hier nicht der Durchschnitt, sondern der Modus in den Zeilen 13-20 berechnet wird. Als zweites Argument der <code>if_else</code> Funktion wird der Modus der Spalte <code>sex</code> berechnet.</li>
</ol>
<p>Vorteile der Lagemaßimputation umfassen die Einfachheit der Implementierung, schnelle Berechenbarkeit und Stabilität.</p>
</section>
<section id="imputation-durch-regression" class="level4" data-number="3.3.1.2">
<h4 data-number="3.3.1.2" class="anchored" data-anchor-id="imputation-durch-regression"><span class="header-section-number">3.3.1.2</span> Imputation durch Regression</h4>
<p>Neben der Imputation durch Lagemaße werden heutzutage auch oft komplexere Algorithmen verwendet, welche die fehlenden Daten genauer approximieren können. Eine relativ einfache, aber dennoch fortgeschrittene Methode ist die Imputation mithilfe eines linearen Modells. Falls in einem Datensatz mit unabhängigen Variablen <span class="math inline">\(X = (X_1, X_2, ..., X_J)\)</span> zum Beispiel Werte in der Spalte <span class="math inline">\(X_j, 1\leq j\leq J\)</span> vorhanden sind, so kann mithilfe eines MLR Modells mit der Modellgleichung</p>
<p><span class="math display">\[ X_j = \sum_{i=1,\\ i\neq j}^J \beta_iX_i+\beta_0+\varepsilon\]</span> geschätzt werden. Zum schätzen der Parameter können wir hierbei alle Einträge verwenden, in welcher die Variable <span class="math inline">\(X_j\)</span> vorhanden ist. Dieser Ansatz funktioniert vor allem dann gut, wenn die unterliegenden Daten alle Annahmen des MLR Modells erfüllen.</p>
<p>Mihthilfe der <code>{mice}</code> Library<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, können wir nicht nur eine Imputation wie in <a href="#sec-coldimp" class="quarto-xref"><span>Section 3.3.1.1</span></a> durchführen, sondern auch eine Regression wie sie oben beschrieben wurde. Hierfür benötigen wir die Funktion <code>mice</code> und <code>complete</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>methods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">bill_length_mm =</span> <span class="st">"norm.predict"</span>,</span>
<span id="cb11-4"><a href="#cb11-4"></a>            <span class="at">bill_depth_mm =</span> <span class="st">"norm.predict"</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>            <span class="at">flipper_length_mm =</span> <span class="st">"norm.predict"</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>            <span class="at">body_mass_g =</span> <span class="st">"norm.predict"</span>,</span>
<span id="cb11-7"><a href="#cb11-7"></a>            <span class="at">sex =</span> <span class="st">"logreg"</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>            )</span>
<span id="cb11-9"><a href="#cb11-9"></a></span>
<span id="cb11-10"><a href="#cb11-10"></a>data_penguin_imputed <span class="ot">&lt;-</span> data_penguin <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11"></a>  <span class="fu">mice</span>(<span class="at">method =</span> methods,</span>
<span id="cb11-12"><a href="#cb11-12"></a>       <span class="at">blocks =</span> <span class="fu">names</span>(methods),</span>
<span id="cb11-13"><a href="#cb11-13"></a>       <span class="at">maxit =</span> <span class="dv">5</span>,</span>
<span id="cb11-14"><a href="#cb11-14"></a>       <span class="at">m =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>  <span class="fu">complete</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>In der ersten Zeile fügen wir die <code>{mice}</code> Library unserer Session hinzu.</li>
<li>In den Zeilen 3-7 spezifizieren wir für jede Variable mit fehlenden Werten eine Methode, welche für die Imputation verwendet werden soll. Die Methode <code>"norm.predict"</code> spezifiziert hierbei ein MLR Modell für die numerischen Variablen und <code>"logreg"</code> ein logistisches Modell für die nominale Variable <code>"sex"</code>.</li>
<li>In Zeile 10 generieren wir einen neuen Datensatz <code>data_penguin_imputed</code>, welcher später den vervollständigten Datensatz enthält.</li>
<li>Anschließend wenden wir auf den alten Datensatz in den Zeilen 10-14 die <code>mice</code> Funktion an. Das Argument <code>method</code> spezifiziert wie wir die Fehlenden Werte ersetzen wollen (als Argument geben wir hierbei den gleichnamigen Vektor aus Zeile 3 an). Das Argument <code>blocks</code> spezifiziert auf welche Variablen die jeweiligen Imputationsalgorithmen angewendet werden sollen. Durch den Wert <code>names(methods)</code> können wir direkt die Imputationsalgorithmen mit den entsprechenden Variablen matchen.</li>
<li>Das Argument <code>maxit=1</code> in Zeile 9 spezifiziert die Anzahl der Iterationen für das generieren der syntetischen Daten. Die Details hierfür würden den Rahmen der Vorlesung sprengen und können unter <a href="https://cran.r-project.org/web/packages/mice/mice.pdf">diesem Link</a> bei Interesse nachgeschlagen werden. Wichtig ist nur das Verständnis, dass eine höhere Anzahl an Iterationen stabilere Werte liefern kann.</li>
<li>Das Argument <code>m</code> beschreibt wie oft ein Datensatz mithilfe der Imputationstechniken erzeugt werden soll. Das Argument <code>m=1</code> spezifiziert somit, dass wir nur einen solchen Datensatz erzeugen wollen.</li>
<li>Da der Rückgabewert der <code>mice</code> Funktion ein Objekt ist, welches mehr als nur den vervollständigten Datensatz enthält, verwenden wir zum schluss die <code>complete</code> Funktion, welche uns einen vervollständigten Datensatz zurückgibt.</li>
</ol>
<p>Wir können nun nochmals überprüfen, ob wirklich alle Werte befüllt wurden:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data_penguin_imputed <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colSums</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  [,1]
species              0
island               0
bill_length_mm       0
bill_depth_mm        0
flipper_length_mm    0
body_mass_g          0
sex                  0
year                 0</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="merkmalsselektion-mithilfe-von-lasso-regression" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="merkmalsselektion-mithilfe-von-lasso-regression"><span class="header-section-number">3.4</span> Merkmalsselektion mithilfe von Lasso-Regression</h2>
<p>Ein weiteres wichtiges Thema ist die Variablenselektion. Motivierende Faktoren für die Variablenselektion sind vor allem:</p>
<ul>
<li>In Umfangreichen Datensätzen haben nicht alle unabhängigen Variablen aufgrund von Multikollinearität einen signifikanten Einfluss auf die Zielvariable.</li>
<li>Falls Interpretierbarkeit eine große Rolle spielt ist es manchmal vorteilhaft sich auf einige wenige Variablen festzulegen, welche die geschätzte Variable hinreichend gut erklären.</li>
</ul>
<p>In der Vorlesung wurden bereits Methoden wie <em>Forward</em>, <em>Backward</em> und <em>Stepwise</em> Selektion behandelt. Wir wollen deshalb in diesem Abschnitt eine weitere, sehr wichtige Methodik betrachten, welche auf der Idee der linearen Regression aufbaut.</p>
<p>Angenommen wir befinden uns in dem bekannten Fall, dass ein Datensatz <span class="math inline">\(X = (X_1,...,X_J)\)</span> mit <span class="math inline">\(X_J\in\mathbb{R}^K\)</span>, <span class="math inline">\(K\)</span> Realisierungen der Zielvariable <span class="math inline">\(Y=(y_1,...,y_k)\)</span> vorliegen und wir die Parameter <span class="math inline">\(\hat{b_0},...,\hat{b_J}\)</span> schätzen wollen. Die Schätzung der Parameter kann zum Beispiel durch die Minimierung des MSE (siehe vorheriges Kapitel) durchgeführt werden:</p>
<p><span class="math display">\[
\min_{b_0,...,b_J}\frac{1}{K}\sum_{k=1}^K (y_k-(b_0+b_1x_{1,k}+...+b_Jx_{J,k}))^2
\]</span> Durch das hinzufügen eines sogenannten <em>Penalty</em> Terms, können wir steuern, dass Parameter <span class="math inline">\(b_j\)</span>, welche keinen großen Einfluss auf die Zielvariable haben verkleinert, oder sogar ganz eliminiert werden:</p>
<p><span id="eq-lasso"><span class="math display">\[
\min_{b_0,...,b_J}\frac{1}{K}\sum_{k=1}^K (y_k-(b_0+b_1x_{1,k}+...+b_Jx_{J,k}))^2+\lambda\sum_{j=0}^J|b_j|
\tag{3.1}\]</span></span></p>
<p><span class="math inline">\(\lambda\in[0,\infty)\)</span> (lambda) steht hier für den Penalty Wert. Je größer dieser Wert ist, desto stärker werden die Parameter bestraft. Für die genaue Funktionsweise und Methodik hinter diesem Konzept, siehe <a href="https://en.wikipedia.org/wiki/Lasso_(statistics)">Wikipedia Artikel</a>. Wichtig an dieser Stelle ist lediglich zu verstehen wie der Fehlerterm in <a href="#eq-lasso" class="quarto-xref">Gleichung&nbsp;<span>3.1</span></a> definiert ist und welchen Einfluss der Parameter <span class="math inline">\(\lambda\)</span> hat.</p>
<p>Die R Syntax zum trainieren und evaluieren eines solchen Modells ist sehr nah an der einens MLR Modells:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mlr_spec_lasso <span class="ot">&lt;-</span><span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="dv">20</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">mixture =</span> <span class="dv">1</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">engine =</span> <span class="st">"glmnet"</span>) </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>mlr_lasso_fit <span class="ot">&lt;-</span> mlr_spec_lasso <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> data_train,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> body_mass_g<span class="sc">~</span>.)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>mlr_lasso_fit <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   term              estimate penalty
   &lt;chr&gt;                &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)       63116.        20
 2 speciesChinstrap   -173.        20
 3 speciesGentoo       676.        20
 4 islandDream          -4.23      20
 5 islandTorgersen       0         20
 6 bill_length_mm        9.03      20
 7 bill_depth_mm         0         20
 8 flipper_length_mm    21.0       20
 9 sexmale             454.        20
10 year                -31.8       20</code></pre>
</div>
</div>
<p>Bevor wir den obigen Code analysieren, macht es Sinn den Rückgabewert zu betrachten. Das Tibble enthält drei Spalten, wobei in der ersten der Variablenname, in der zweiten der geschätzte Lasso Parameter <span class="math inline">\(b^{\text{Lasso}}_j\)</span> und in der dritten der Term <span class="math inline">\(\lambda = 20\)</span> steht. Der Parameter <span class="math inline">\(\lambda = 20\)</span> hat dafür gesorgt, dass die geschätzten Parameter für die Variablen <code>bill_depth_mm</code> und <code>islandTorgersen</code> auf <span class="math inline">\(0\)</span> reduziert wurden. Da <code>islandTorgersen</code> teil eines Dummy Konstrukts ist, können wir diese nicht direkt entfernen. Allerdings könnten wir auf Basis unsere Analyse zum Beispiel die Variable <code>bill_depth_mm</code> entfernen.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Achtung">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Achtung
</div>
</div>
<div class="callout-body-container callout-body">
<p>Die geschätzten Parameter sind nicht mehr <em>unbiased</em>, weshalb eine statisticshe Analyse, zum Beispiel durch den <span class="math inline">\(t\)</span>-Test, hier weniger sinnvoll ist als bei einem MLR Modell.</p>
</div>
</div>
<p>Nun zurück zum Code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>mlr_spec_lasso <span class="ot">&lt;-</span><span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="dv">20</span>,</span>
<span id="cb16-2"><a href="#cb16-2"></a>                            <span class="at">mixture =</span> <span class="dv">1</span>,</span>
<span id="cb16-3"><a href="#cb16-3"></a>                            <span class="at">engine =</span> <span class="st">"glmnet"</span>) </span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a>mlr_lasso_fit <span class="ot">&lt;-</span> mlr_spec_lasso <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="fu">fit</span>(<span class="at">data =</span> data_train,</span>
<span id="cb16-7"><a href="#cb16-7"></a>      <span class="at">formula =</span> body_mass_g<span class="sc">~</span>.)</span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a>mlr_lasso_fit <span class="sc">%&gt;%</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Im Verlgeich zu einem MLR Modell wie in <a href="02_Lineare_Regression.html#sec-MLRR" class="quarto-xref"><span>Section 2.3.1</span></a>, haben wir bei der Modellspezifikation durch die <code>linear_reg</code> Funktion die Argumente <code>penalty</code> und <code>mixture</code> ergänzt. Wie bereits besprochen, steht penalty hier für den Parameter <span class="math inline">\(\lambda\)</span> aus <a href="#eq-lasso" class="quarto-xref">Gleichung&nbsp;<span>3.1</span></a>. Der Parameter <code>mixture = 1</code> spezifiziert hierbei, dass es sich um ein Lasso Model handelt. Der Parameter <code>mixture</code> kann Werte in dem Intervall <span class="math inline">\([0,1]\)</span> annehmen, wobei wir ausschließlich an dem Fall <code>mixture=1</code> interessiert sind. Außerdem haben wir in Zeile 3 das Argument <code>engine = "glmnet"</code> spezifiziert. Dieses steuert, dass die Parameter nicht mehr wie bei einer linearen Regression berechnet werden (aufgrund des Penalty Terms) sondern durch ein Optimierungsverfahren, welches <a href="#eq-lasso" class="quarto-xref">Gleichung&nbsp;<span>3.1</span></a> löst. Im letzten Schritt rufen wir nicht wie gewohnt die <code>extract_fit_engine()</code> und <code>summary()</code> Funktionen auf, sondern wenden auf das trainierte Modell die <code>tidy()</code> Funktion an, welche die geschätzten Parameter als Tibble zurückgibt.</p>
</section>
<section id="übungsaufgaben" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="übungsaufgaben"><span class="header-section-number">3.5</span> Übungsaufgaben</h2>
<p>In dieser Übung werden wir uns nochmal mit dem <code>hotel_rates</code> Datensatz aus den Übungen <a href="02_Lineare_Regression.html#exr-eda_hotel" class="quarto-xref">Aufgabe&nbsp;<span>2.8</span></a> - <a href="02_Lineare_Regression.html#exr-mlrassumptions" class="quarto-xref">Aufgabe&nbsp;<span>2.11</span></a> auseinandersetzen.</p>
<p>Verwende die untenstehende Version des <code>hotel_rates</code> Datensatzes für die folgenden Aufgaben.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>hotel_rates_filtered <span class="ot">&lt;-</span> hotel_rates <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">arrival_month =</span> <span class="fu">factor</span>(<span class="fu">month</span>(arrival_date)),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">num_guests =</span> adults<span class="sc">+</span>children,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">is_repeated_guest =</span> <span class="fu">factor</span>(is_repeated_guest),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(num_guests,total_of_special_requests,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>          required_car_parking_spaces,arrival_month,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>          is_repeated_guest,lead_time,stays_in_week_nights,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>          avg_price_per_room,country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="exr-missingvalues" class="theorem exercise">
<p><span class="theorem-title"><strong>Aufgabe 3.1</strong></span> &nbsp;</p>
<ol type="1">
<li><p>In der Variable <code>country</code> wurden Fehlende Werte mit dem String <code>"null"</code> enkodiert. Finde heraus wie viele Einträge der Variable <code>country</code> den Wert <code>"null"</code> besitzen.</p></li>
<li><p>Verwende die <code>dplyr::na_if</code> Funktion um die mit <code>"null"</code> enkodierte Werte in den Wert <code>NA</code> umzuwandeln.</p></li>
<li><p>Wir wollen nun die fehlenden Werte ergänzen. Da die Variable <code>country</code> nominal ist, können wir keine lineare Regresison anwenden. Wende stattdessen in der <code>mice()</code> Funktion die Methode <code>"cart"</code> an, was für <em>Classification And Regression Trees</em> steht (diese werden im folgenden Kapitel genauer beleuchtet). Setze die Parameter <code>maxit</code> und <code>m</code> beide auf <code>1</code> und erzeuge dann mithilfe der <code>complete()</code>Funktion einen neuen Datensatz <code>hotel_rate_imp</code>, welcher die imputierten Werte enthält.</p></li>
</ol>
</div>
<div id="exr-filter_countries" class="theorem exercise">
<p><span class="theorem-title"><strong>Aufgabe 3.2</strong></span> &nbsp;</p>
<ol type="1">
<li><p>Da in dem Datensatz etwa 100 verschiedene Nationalitäten vertreten sind, wir aber nur an jenen interessiert sind welche zur Erklärung der Zielvariable beitragen, sollte die Spalte <code>country</code> gefiltert werden. Der folgende Vektor enthält 39 Country-Codes, von welchen wir vermuten, dass sie einen statistisch signifikanten Einfluss auf die Variable <code>avg_price_per_room</code> haben.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cntry_list<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"and"</span>, <span class="st">"aut"</span>, <span class="st">"aze"</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"che"</span>, <span class="st">"chl"</span>, <span class="st">"cze"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"esp"</span>, <span class="st">"geo"</span>, <span class="st">"hun"</span>, <span class="st">"ita"</span>, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"lux"</span>, <span class="st">"mar"</span>, <span class="st">"mwi"</span>, <span class="st">"nga"</span>, <span class="st">"prt"</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"rus"</span>, <span class="st">"swe"</span>, <span class="st">"tur"</span>, <span class="st">"twn"</span>, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">"usa"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Passe unter Verwendung der <code>filter()</code> Funktion und des <code>%in%</code> Operators den Datensatz aus <a href="#exr-missingvalues" class="quarto-xref">Aufgabe&nbsp;<span>3.1</span></a> so an, dass dieser nur noch Einträge enthält, welche in der Spalte <code>country</code> einen Wert des obigen Vektors enthalten.</p></li>
<li><p>Entferne mit der gleichen Methode alle Einträge, welche in der Spalte <code>arrival_month</code> die Werte <code>month2</code> und <code>month11</code> enthalten.</p></li>
</ol>
</div>
<div id="exr-train_test" class="theorem exercise">
<p><span class="theorem-title"><strong>Aufgabe 3.3</strong></span> Verwende den in <a href="#exr-filter_countries" class="quarto-xref">Aufgabe&nbsp;<span>3.2</span></a> erstellten Datensatz um ein Trainings- und Testdatensatz im Verhältnis 4:1 zu erstellen. Um die Reproduzierbarkeit sicherzustellen, verwende den <code>set.seed(123)</code> Befehl.</p>
</div>
<div id="exr-mlr_train" class="theorem exercise">
<p><span class="theorem-title"><strong>Aufgabe 3.4</strong></span> &nbsp;</p>
<ol type="1">
<li>Verwende die in der vorherigen Aufgabe erstellen Trainingsdaten um ein MLR Modell wie in Aufgabe <a href="02_Lineare_Regression.html#exr-mlrfit" class="quarto-xref">Aufgabe&nbsp;<span>2.9</span></a> zu schätzen.</li>
<li>Welches der noch im Datensatz enthaltenen Herkunftsländer hat den größten Einfluss auf den durchschnittlichen Zimmerpreis?</li>
<li>Berechne anschließend für beide Teildatensätze den <span class="math inline">\(R^2\)</span> und <span class="math inline">\(RMSE\)</span> und Vergleiche die beiden Werte.</li>
</ol>
</div>
<div id="exr-cv" class="theorem exercise">
<p><span class="theorem-title"><strong>Aufgabe 3.5</strong></span> Verwende den Datensatz aus <a href="#exr-filter_countries" class="quarto-xref">Aufgabe&nbsp;<span>3.2</span></a> um ein 5-Fold Cross-Validation (CV) Objekt zu erstellen. Schätze anschließend auf diesem CV Objekt ein MLR Modell wie in <a href="#exr-mlr_train" class="quarto-xref">Aufgabe&nbsp;<span>3.4</span></a> und vergleiche den CV-RMSE mit dem Test RMSE aus Aufgabe <a href="#exr-mlr_train" class="quarto-xref">Aufgabe&nbsp;<span>3.4</span></a>. Achte auch hierbei auf Reproduzierbarkeit und verwende den Befehl <code>set.seed(123)</code>.</p>
</div>
</section>
<section id="lösungen" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="lösungen"><span class="header-section-number">3.6</span> Lösungen</h2>
<div id="sol-missingvalues" class="proof solution">
<p><span class="proof-title"><em>Solution 3.1</em> (<a href="#sol-missingvalues" class="quarto-xref">Solution&nbsp;<span>3.1</span></a>). </span></p>
<ol type="1">
<li><!-- -->
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>hotel_rates_filtered <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country<span class="sc">==</span><span class="st">"null"</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><!-- -->
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>hotel_rate_filtered_na <span class="ot">&lt;-</span> hotel_rates_filtered <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">country=</span><span class="fu">na_if</span>(country,<span class="st">"null"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><!-- -->
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>hotel_rate_imp <span class="ot">&lt;-</span> hotel_rate_filtered_na <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mice</span>(<span class="at">method =</span> <span class="st">"cart"</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">blocks =</span> <span class="fu">c</span>(<span class="st">"country"</span>),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">maxit =</span> <span class="dv">1</span> ,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">m =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ol>
</div>
<div id="sol-filter_countries" class="proof solution">
<p><span class="proof-title"><em>Solution 3.2</em> (<a href="#exr-filter_countries" class="quarto-xref">Aufgabe&nbsp;<span>3.2</span></a>). </span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>hotel_rate_imp <span class="ot">&lt;-</span> hotel_rate_imp <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> cntry_list, arrival_month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Durch das Hinzufügen von zwei Argumenten in der <code>filter</code> Funktion werden nur einträge zurückgegeben, welche auch beide Bedingungen erfüllen. Der <code>%in%</code> Operator in den beiden Bedingungen überprüft für jedes Element einer Liste auf der linken Seite des Operators, ob dieses in einer Liste auf der rechten Seite des Operators vorhanden ist. Der Rückgabewert des Operators ist eine liste, welche die Werte <code>TRUE</code> und <code>FALSE</code> enthält. Ein Eintrag besitzt z.B. den Wert <code>TRUE</code>, falls der in <code>country</code> betrachtete Wert in der Liste <code>cntry_list</code> vorhanden ist und sonst <code>FALSE</code>.</p>
</div>
<div id="sol-train_test" class="proof solution">
<p><span class="proof-title"><em>Solution 3.3</em> (<a href="#exr-train_test" class="quarto-xref">Aufgabe&nbsp;<span>3.3</span></a>). </span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>split_hotels <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(hotel_rate_imp, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>data_train <span class="ot">&lt;-</span> <span class="fu">training</span>(split_hotels)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>data_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(split_hotels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="sol-mlr_train" class="proof solution">
<p><span class="proof-title"><em>Solution 3.4</em> (<a href="#exr-mlr_train" class="quarto-xref">Aufgabe&nbsp;<span>3.4</span></a>). </span></p>
<ol type="1">
<li><!-- -->
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mlr_res <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">formula =</span> avg_price_per_room <span class="sc">~</span>., <span class="at">data =</span> data_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><!-- -->
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>mlr_res <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  lm.beta<span class="sc">::</span><span class="fu">lm.beta</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"country"</span>,term)) <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="fu">mutate</span>(<span class="at">std_estimate =</span> <span class="fu">abs</span>(std_estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(std_estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8"></a>  <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  term       estimate std_estimate std.error statistic p.value
  &lt;chr&gt;         &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 countryprt    -72.3        0.466      26.9     -2.69 0.00712</code></pre>
</div>
</div>
<p>Das Herkunftsland mit dem Code <code>prt</code>, was für Portugal steht hat den größten Einfluss auf den Preis.</p>
<p>Zur Erklärung des Codes:</p>
<p>Um herauszufinden welches Herkunftsland den größten Einfluss auf den durchschnittlichen Zimmerpreis hat, müssen wir auf das MLR Modell die <code>lm.beta()</code> Funktion angeben. Dadurch, dass im Modell relativ viele Dummy Variablen enthalten sind, speichern wir durch das Anwenden der <code>tibble()</code> Funktion in Zeile 4 die Ergebnisse in einem Tibble. Das erlaubt uns dann in Zeile 5 die <code>filter()</code> Funktion anzuwenden. In Zeile 5 verwenden wir in der <code>filter()</code> Funktion die <code>grepl()</code> Funktion, welche das im ersten Argument gegebene Muster (<code>country</code>) in der Spalte <code>term</code> sucht und nur jene Einträge zurückgibt, welche den String <code>"country"</code> enthalten. Wir sortieren somit alle Variablen aus, welche keine Informationen über das Herkunftsland liefern. In Zeile 6 wenden wir die BEtragsfunktion (<code>abs()</code>) auf die Spalte <code>std_estimate</code> an. Durch die <code>arrange(desc(...))</code> Funktion in Zeile 7 erreichen wir, dass die Einträge der Größe nach absteigend sortiert sind, so dass wir dann in Zeile 8 mit dem <code>head(1)</code> Befehl jene Variable ausgegen können, welche den größten Einfluss auf die Zielvariable besitzt.</p></li>
<li><!-- -->
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>multi_metric <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(rmse,rsq)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>test_metrics <span class="ot">&lt;-</span> mlr_res <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(data_test) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multi_metric</span>(.pred,avg_price_per_room) <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dset =</span> <span class="st">"test"</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>train_metrics <span class="ot">&lt;-</span> mlr_res <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(data_train) <span class="sc">%&gt;%</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multi_metric</span>(.pred,avg_price_per_room) <span class="sc">%&gt;%</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dset =</span> <span class="st">"train"</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(train_metrics,test_metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="flaphrowoi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#flaphrowoi table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#flaphrowoi thead, #flaphrowoi tbody, #flaphrowoi tfoot, #flaphrowoi tr, #flaphrowoi td, #flaphrowoi th {
  border-style: none;
}

#flaphrowoi p {
  margin: 0;
  padding: 0;
}

#flaphrowoi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#flaphrowoi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#flaphrowoi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#flaphrowoi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#flaphrowoi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#flaphrowoi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#flaphrowoi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#flaphrowoi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#flaphrowoi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#flaphrowoi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#flaphrowoi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#flaphrowoi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#flaphrowoi .gt_spanner_row {
  border-bottom-style: hidden;
}

#flaphrowoi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#flaphrowoi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#flaphrowoi .gt_from_md > :first-child {
  margin-top: 0;
}

#flaphrowoi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#flaphrowoi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#flaphrowoi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#flaphrowoi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#flaphrowoi .gt_row_group_first td {
  border-top-width: 2px;
}

#flaphrowoi .gt_row_group_first th {
  border-top-width: 2px;
}

#flaphrowoi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#flaphrowoi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#flaphrowoi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#flaphrowoi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#flaphrowoi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#flaphrowoi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#flaphrowoi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#flaphrowoi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#flaphrowoi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#flaphrowoi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#flaphrowoi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#flaphrowoi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#flaphrowoi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#flaphrowoi .gt_left {
  text-align: left;
}

#flaphrowoi .gt_center {
  text-align: center;
}

#flaphrowoi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#flaphrowoi .gt_font_normal {
  font-weight: normal;
}

#flaphrowoi .gt_font_bold {
  font-weight: bold;
}

#flaphrowoi .gt_font_italic {
  font-style: italic;
}

#flaphrowoi .gt_super {
  font-size: 65%;
}

#flaphrowoi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#flaphrowoi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#flaphrowoi .gt_indent_1 {
  text-indent: 5px;
}

#flaphrowoi .gt_indent_2 {
  text-indent: 10px;
}

#flaphrowoi .gt_indent_3 {
  text-indent: 15px;
}

#flaphrowoi .gt_indent_4 {
  text-indent: 20px;
}

#flaphrowoi .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id=".metric" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.metric</th>
<th id=".estimator" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.estimator</th>
<th id=".estimate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">.estimate</th>
<th id="dset" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">dset</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=".metric">rmse</td>
<td class="gt_row gt_left" headers=".estimator">standard</td>
<td class="gt_row gt_right" headers=".estimate">37.767</td>
<td class="gt_row gt_left" headers="dset">train</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=".metric">rsq</td>
<td class="gt_row gt_left" headers=".estimator">standard</td>
<td class="gt_row gt_right" headers=".estimate">0.746</td>
<td class="gt_row gt_left" headers="dset">train</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=".metric">rmse</td>
<td class="gt_row gt_left" headers=".estimator">standard</td>
<td class="gt_row gt_right" headers=".estimate">38.238</td>
<td class="gt_row gt_left" headers="dset">test</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=".metric">rsq</td>
<td class="gt_row gt_left" headers=".estimator">standard</td>
<td class="gt_row gt_right" headers=".estimate">0.732</td>
<td class="gt_row gt_left" headers="dset">test</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Es ist nicht weiter überraschend, dass der IS RMSE und <span class="math inline">\(R^2\)</span> höher ist, als die OOS Metriken, da wir die Parameter des MLR Modells auf Basis der Trainingsdaten geschätzt haben.</p></li>
</ol>
</div>
<div id="sol-cv" class="proof solution">
<p><span class="proof-title"><em>Solution 3.5</em> (<a href="#exr-cv" class="quarto-xref">Aufgabe&nbsp;<span>3.5</span></a>). </span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>folds_hotel <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(hotel_rate_imp, <span class="at">v =</span><span class="dv">5</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>mlr_fit_cv <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> folds_hotel,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">preprocessor =</span> avg_price_per_room <span class="sc">~</span>.</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>metrics_cv <span class="ot">&lt;-</span> mlr_fit_cv <span class="sc">%&gt;%</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dset =</span> <span class="st">"cv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(n,std_err,.config)) <span class="sc">%&gt;%</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="fu">c</span>(<span class="st">".estimate"</span> <span class="ot">=</span> <span class="st">"mean"</span>))</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(metrics_cv,test_metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="rmyqurzptf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rmyqurzptf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rmyqurzptf thead, #rmyqurzptf tbody, #rmyqurzptf tfoot, #rmyqurzptf tr, #rmyqurzptf td, #rmyqurzptf th {
  border-style: none;
}

#rmyqurzptf p {
  margin: 0;
  padding: 0;
}

#rmyqurzptf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rmyqurzptf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rmyqurzptf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rmyqurzptf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rmyqurzptf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rmyqurzptf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rmyqurzptf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rmyqurzptf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rmyqurzptf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rmyqurzptf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rmyqurzptf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rmyqurzptf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rmyqurzptf .gt_spanner_row {
  border-bottom-style: hidden;
}

#rmyqurzptf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rmyqurzptf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rmyqurzptf .gt_from_md > :first-child {
  margin-top: 0;
}

#rmyqurzptf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rmyqurzptf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rmyqurzptf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rmyqurzptf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rmyqurzptf .gt_row_group_first td {
  border-top-width: 2px;
}

#rmyqurzptf .gt_row_group_first th {
  border-top-width: 2px;
}

#rmyqurzptf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rmyqurzptf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rmyqurzptf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rmyqurzptf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rmyqurzptf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rmyqurzptf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rmyqurzptf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rmyqurzptf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rmyqurzptf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rmyqurzptf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rmyqurzptf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rmyqurzptf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rmyqurzptf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rmyqurzptf .gt_left {
  text-align: left;
}

#rmyqurzptf .gt_center {
  text-align: center;
}

#rmyqurzptf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rmyqurzptf .gt_font_normal {
  font-weight: normal;
}

#rmyqurzptf .gt_font_bold {
  font-weight: bold;
}

#rmyqurzptf .gt_font_italic {
  font-style: italic;
}

#rmyqurzptf .gt_super {
  font-size: 65%;
}

#rmyqurzptf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rmyqurzptf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rmyqurzptf .gt_indent_1 {
  text-indent: 5px;
}

#rmyqurzptf .gt_indent_2 {
  text-indent: 10px;
}

#rmyqurzptf .gt_indent_3 {
  text-indent: 15px;
}

#rmyqurzptf .gt_indent_4 {
  text-indent: 20px;
}

#rmyqurzptf .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id=".metric" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.metric</th>
<th id=".estimator" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.estimator</th>
<th id=".estimate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">.estimate</th>
<th id="dset" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">dset</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=".metric">rmse</td>
<td class="gt_row gt_left" headers=".estimator">standard</td>
<td class="gt_row gt_right" headers=".estimate">38.101</td>
<td class="gt_row gt_left" headers="dset">cv</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=".metric">rsq</td>
<td class="gt_row gt_left" headers=".estimator">standard</td>
<td class="gt_row gt_right" headers=".estimate">0.740</td>
<td class="gt_row gt_left" headers="dset">cv</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=".metric">rmse</td>
<td class="gt_row gt_left" headers=".estimator">standard</td>
<td class="gt_row gt_right" headers=".estimate">38.238</td>
<td class="gt_row gt_left" headers="dset">test</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=".metric">rsq</td>
<td class="gt_row gt_left" headers=".estimator">standard</td>
<td class="gt_row gt_right" headers=".estimate">0.732</td>
<td class="gt_row gt_left" headers="dset">test</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Die Metriken gemessen am Testset sind konservativer. Das könnte daran liegen, dass das einmal auf den Trainingsdaten geschätzte Lineare Modell sich zu stark an die Trainingsdaten angepasst hat.</p>
</div>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Diese muss eventuell über den Befehl <code>install.packages("mice")</code> installiert werden<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./02_Lineare_Regression.html" class="pagination-link" aria-label="Lineare Regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lineare Regression</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04_Regressions_Baeume.html" class="pagination-link" aria-label="Regressionsbäume">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regressionsbäume</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>